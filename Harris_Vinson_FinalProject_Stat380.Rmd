---
title: "R Notebook"
author: "Remington Harris and Cameron Vinson"
date: "May 1st 2019"
output: html_notebook
---

## Front Matter


```{r include=FALSE}

# Clean workspace

rm(list = ls())

# Packages used

library(mosaic)
library(tidyr)
library(readr)
library(tidyverse)
library(rvest)
library(regexPipes)
library(growthrates)


# Inputs & source data

PopURL <-
  "https://en.wikipedia.org/wiki/List_of_countries_by_past_and_future_population"

PopXPATH<-
  '//*[@id="mw-content-text"]/div/table[2]'


EmissionsURL <-
  "http://edgar.jrc.ec.europa.eu/overview.php?v=CO2ts_pc1990-2013"

EmissionsXPATH <-
  '//*[@id="layout"]/div[3]/div[2]/div/div/div/div/table'

# User defined Functions

```


## Data Wrangling


### Loading Population Data Table


```{r}
table_list <- 
  PopURL %>%
  read_html() %>%
  html_nodes(xpath = PopXPATH) %>%
  html_table(fill = TRUE)

Pop_Country <- table_list[[1]] 

head(Pop_Country)
```


### Cleaning Population Data Table


```{r}
index <- as.character(c(1,2,3,4,5,6,7,8,9,10,11,12,13,14,15))

colnames(Pop_Country) <- index

Pop_Country <-
  Pop_Country %>%
  rename(
    Country = `1`,
    `1985 Pop` = `2`,
    `1990 Pop` = `4`,
    `1995 Pop` = `6`,
    `2000 Pop` = `8`,
    `2005 Pop` = `10`,
    `2010 Pop` = `12`,
    `2015 Pop` = `14`) %>%
  select(Country, `1985 Pop`, `1990 Pop`, `1995 Pop`, `2000 Pop`, `2005 Pop`, `2010 Pop`, `2015 Pop`)

head(Pop_Country)
```

```{r}
Pop_Country$`1985 Pop` <-
  Pop_Country$`1985 Pop` %>%
  regexPipes::gsub(pattern = ",", replacement = "")
  
Pop_Country$`1990 Pop` <-
  Pop_Country$`1990 Pop` %>%
  regexPipes::gsub(pattern = ",", replacement = "")

Pop_Country$`1995 Pop` <-
  Pop_Country$`1995 Pop` %>%
  regexPipes::gsub(pattern = ",", replacement = "")

Pop_Country$`2000 Pop` <-
  Pop_Country$`2000 Pop` %>%
  regexPipes::gsub(pattern = ",", replacement = "")

Pop_Country$`2005 Pop` <-
  Pop_Country$`2005 Pop` %>%
  regexPipes::gsub(pattern = ",", replacement = "")

Pop_Country$`2010 Pop` <-
  Pop_Country$`2010 Pop` %>%
  regexPipes::gsub(pattern = ",", replacement = "")

Pop_Country$`2015 Pop` <-
  Pop_Country$`2015 Pop` %>%
  regexPipes::gsub(pattern = ",", replacement = "")

Pop_Country_Cleaned <-
  Pop_Country %>%
  mutate(`1985 Pop` = as.numeric(Pop_Country$`1985 Pop`),
         `1990 Pop` = as.numeric(Pop_Country$`1990 Pop`),
         `1995 Pop` = as.numeric(Pop_Country$`1995 Pop`),
         `2000 Pop` = as.numeric(Pop_Country$`2000 Pop`),
         `2005 Pop` = as.numeric(Pop_Country$`2005 Pop`),
         `2010 Pop` = as.numeric(Pop_Country$`2010 Pop`),
         `2015 Pop` = as.numeric(Pop_Country$`2015 Pop`))

head(Pop_Country_Cleaned)
```


### Loading Emissions Data


```{r}
table_list <-
  EmissionsURL %>%
  read_html() %>%
  html_nodes(xpath = EmissionsXPATH) %>%
  html_table(fill = TRUE)

CarbonRaw <-
  table_list[[1]]

head(CarbonRaw)
```


### Cleaning Emissions Data


```{r}
colnames(CarbonRaw) <-
  as.character(unlist(CarbonRaw[1,]))

CarbonRaw2 <-
  CarbonRaw[-1, ]

CarbonRaw3 <-
  CarbonRaw2[-1, ]

CarbonRaw4 <-
  CarbonRaw3 %>%
  #Making names more easy to wrangle
  rename(`1990` = `1990TonsCO2/cap4.267`,
         `1995` = `1995TonsCO2/cap4.120`,
         `2000` = `2000TonsCO2/cap4.146`,
         `2005` = `2005TonsCO2/cap4.513`,
         `2010` = `2010TonsCO2/cap4.780`,
         `2011` = `2011TonsCO2/cap4.870`,
         `2012` = `2012TonsCO2/cap4.894`,
         `2013` = `2013TonsCO2/cap4.936`)

head(CarbonRaw4)
```

```{r}
CarbonCleaned <-
  CarbonRaw4 %>%
  # Making Emissions a dbl variable
  transmute(`Country` = `CountryWorld Total`,
         `1990EmissionsPerCap` = as.numeric(CarbonRaw4$`1990`),
         `1995EmissionsPerCap` = as.numeric(CarbonRaw4$`1995`),
         `2000EmissionsPerCap` = as.numeric(CarbonRaw4$`2000`),
         `2005EmissionsPerCap` = as.numeric(CarbonRaw4$`2005`),
         `2010EmissionsPerCap` = as.numeric(CarbonRaw4$`2010`)) 

head(CarbonCleaned)
```
  
```{r}
CarbonCleaned$Country <-
  CarbonCleaned$Country %>%
  # Replacing country names that are in a different form in the Emissions data than the Pop Data
  regexPipes::sub("Korea, Democratic People's Republic of", "South Korea") %>%
  regexPipes::sub("Korea, Republic of", "North Korea") %>%
  regexPipes::sub("Lao People's Democratic Republic", "Laos") %>%
  regexPipes::sub("Macedonia, the former Yugoslav Republic of", "North Macedonia") %>%
  regexPipes::sub("Libyan Arab Jamahiriya", "Libya") %>%
  regexPipes::sub("Macao", "Macau") %>%
  regexPipes::sub("Moldova, Republic of", "Moldova") %>%
  regexPipes::sub("Russian Federation", "Russia") %>%
  regexPipes::sub("Congo_the Democratic Republic of the", "Democratic Republic of the Congo") %>%
  regexPipes::sub("Congo", "Republic of the Congo") %>%
  regexPipes::sub("Democratic Republic of the Republic of the Congo", "Democratic Republic of the Congo") %>%
  regexPipes::sub("Cote d'Ivoire", "Ivory Coast") %>%
  regexPipes::sub("Iran, Islamic Republic of", "Iran") %>%
  regexPipes::sub("Sao Tome and Principe", "São Tomé and Príncipe") %>%
  regexPipes::sub("Taiwan_Province of China", "Taiwan") %>%
  regexPipes::sub("Tanzania_United Republic of", "Tanzania") %>%
  regexPipes::sub("Syrian Arab Republic", "Syria") %>%
  regexPipes::sub("Viet Nam", "Vietnam") %>%
  regexPipes::sub("Virgin Islands_British", "British Virgin Islands") %>%
  regexPipes::sub("Virgin Islands_USA", "United States Virgin Islands") %>%
  regexPipes::sub("Brunei Darussalam", "Brunei")


```


### Cleaning Carrying Capacity

```{r}
TotalBiocapRaw <-
  read.csv(file = "Biocapacity.csv")
```

```{r}
TotalBiocapV1 <-
  TotalBiocapRaw %>%
  select(Country.Name, Total) %>%
  rename(
    Country = Country.Name,
    TotalBioCap = Total
  )
```

```{r}
TotalBiocapV1$Country <- as.character(TotalBiocapV1$Country)
TotalBiocapV1[76, 2] <- 58661671.8495966
TotalBiocapV1[90, 1] <- "North Korea"
TotalBiocapV1[92, 1] <- "South Korea"
TotalBiocapV1[90, 2] <- 14489062.7042875
TotalBiocapV1[92, 2] <- 33985103.3058803
TotalBiocapV1[161, 2] <- 56760871.8701572
TotalBiocapV1[178, 2] <- 80340362.408074
TotalBiocapV1[184, 1] <- "Democratic Republic of Congo"
TotalBiocapV1[184, 2] <- 199469941.479419
```

```{r}
TotalBiocapV2 <-
  TotalBiocapV1 %>%
  na.omit()
```

```{r}
BiocapPerCapRaw <-
  read.csv(file = "BiocapacityperCap.csv")
```


```{r}
BiocapPerCapV1 <- # Some countries will need to be altered manually
  BiocapPerCapRaw %>%
  select(Country.Name, Total) %>%
  rename(BiocapPerCap = Total, Country = Country.Name)

BiocapPerCapV1$Country <-
  as.character(BiocapPerCapV1$Country)
```

```{r}
BiocapPerCapV1[76, 2] <- 0.73073708156185
BiocapPerCapV1[90, 1] <- "North Korea"
BiocapPerCapV1[90, 2] <- 0.571141605267523
BiocapPerCapV1[92, 1] <- "South Korea"
BiocapPerCapV1[92, 2] <- 0.669104805123585
BiocapPerCapV1[161, 2] <- 1.0213896996721
BiocapPerCapV1[178, 2] <- 2.54497767995444
BiocapPerCapV1[184, 1] <- "Democratic Republic of Congo"
BiocapPerCapV1[184, 2] <- 2.53339548470155
```

```{r}
BiocapPerCapV2 <-
  BiocapPerCapV1 %>%
  na.omit()
```


```{r}
CarryingNumbersRaw <-
  TotalBiocapV2 %>%
  inner_join(BiocapPerCapV2, by = "Country")
```

```{r}
CarryingCapacities <-
  CarryingNumbersRaw %>%
  mutate(CarryingCap = CarryingNumbersRaw$TotalBioCap / CarryingNumbersRaw$BiocapPerCap)

CarryingCapacitiesClean <-
  CarryingCapacities[1:187, ]
```


### Joining Data


```{r}
JoinedTable<-
  CarbonCleaned %>%
  left_join(Pop_Country_Cleaned, by = "Country")
```

```{r}
glimpse(JoinedTable)
```

```{r}
JoinedTable2 <-
  JoinedTable %>%
  # Renaming variable and making numbers true
  mutate(`1985Pop` = JoinedTable$`1985 Pop` * 1000,
         `1990Pop` = JoinedTable$`1990 Pop` * 1000,
         `1995Pop` = JoinedTable$`1995 Pop` * 1000,
         `2000Pop` = JoinedTable$`2000 Pop` * 1000,
         `2005Pop` = JoinedTable$`2005 Pop` * 1000,
         `2010Pop` = JoinedTable$`2010 Pop` * 1000,
         `2015Pop` = JoinedTable$`2015 Pop` * 1000) %>%
  select(-`1985 Pop`, -`1990 Pop`, -`1995 Pop`, -`2000 Pop`, -`2005 Pop`, -`2010 Pop`, -`2015 Pop`)

head(JoinedTable2)
```

```{r}
# Combined Serbia and Montenegro numbers since both were separated in the original Population data table
JoinedTable2[165, 7] <- 8281000
JoinedTable2[165, 8] <- 8371000
JoinedTable2[165, 9] <- 8363000
JoinedTable2[165, 10] <- 8338000
JoinedTable2[165, 11] <- 8203000
JoinedTable2[165, 12] <- 8012000
JoinedTable2[165, 13] <- 7825000
```

```{r}
GlobalNumbers <-
  JoinedTable2 %>%
  mutate( # finding total emmisions since previous was per cap
    `1990TotalEmissions` = `1990EmissionsPerCap` * `1990Pop`,
    `1995TotalEmissions` = `1995EmissionsPerCap` * `1995Pop`,
    `2000TotalEmissions` = `2000EmissionsPerCap` * `2000Pop`,
    `2005TotalEmissions` = `2005EmissionsPerCap` * `2005Pop`,
    `2010TotalEmissions` = `2010EmissionsPerCap` * `2010Pop`)

head(GlobalNumbers)
```

```{r}
GlobalNumbers <-
  na.omit(GlobalNumbers)
```

## Data Analysis and Narrative


### Building a model for Population

```{r}
NewPop<-
  GlobalNumbers[, c(1, 7:13)]

NewPop2 <-
  t(NewPop)

CountryNames <-
  NewPop2[1,]

NewPop3 <-
  as.data.frame(NewPop2)

NewPop4 <-
  NewPop3[2:8, ]


```

```{r}
RatesofChange <-
  NewPop %>%
  mutate(Rate = (NewPop$`2015Pop` - NewPop$`1985Pop`)/30)
```

```{r}
ModelPopTable <- 
  cbind(GlobalNumbers$Country) %>%
  as.data.frame() %>%
  rename(
    Country = V1)

ModelPopTable$Country <- as.character(ModelPopTable$Country)
```

```{r}
GlobalInitialPop <-
  GlobalNumbers %>%
  select(Country, `1985Pop`) %>%
  rename(
    InitialPop = `1985Pop`
  )
```

```{r}
ModelPopTable2 <-
  ModelPopTable %>%
  right_join(GlobalInitialPop, by = "Country")
```

```{r}
RatesofChange2 <-
  RatesofChange %>%
  select(Country, Rate)

ModelPopTable3 <-
  ModelPopTable2 %>%
  right_join(RatesofChange2, by = "Country")
```

```{r}
CarryingCapacitiesClean2 <-
  CarryingCapacities %>%
  select(Country, CarryingCap)

CarryingCapacitiesClean2[177, 1] <- "Samoa"
CarryingCapacitiesClean2[22, 1] <- "Brunei"
CarryingCapacitiesClean2[28, 1] <- "Cape Verde"
CarryingCapacitiesClean2[179, 1] <- "Democratic Republic of the Congo"
CarryingCapacitiesClean2[36, 1] <- "Republic of the Congo"
CarryingCapacitiesClean2[81, 1] <- "Ivory Coast"
CarryingCapacitiesClean2[93, 1] <- "Laos"
CarryingCapacitiesClean2[97, 1] <- "Libya"
CarryingCapacitiesClean2[116, 1] <- "North Macedonia"
CarryingCapacitiesClean2[139, 1] <- "Russia"
CarryingCapacitiesClean2[170, 1] <- "United States"
CarryingCapacitiesClean2[175, 1] <- "Vietnam"
CarryingCapacitiesClean2[156, 1] <- "Syria"
CarryingCapacitiesClean2[153, 1] <- "Swaziland"


```

```{r}
ModelPopTable4 <- 
  ModelPopTable3 %>%
  left_join(CarryingCapacitiesClean2, by = "Country")

ModelPopTable4[159, 4] <- 628615 + 8820080
```

```{r}
sum(is.na(ModelPopTable4$CarryingCap))
```

```{r}
NewPop4[] <- lapply(NewPop4, function(x) as.numeric(as.character(x)))
i = 1
colMax <- function(data) sapply(data, max, na.rm = TRUE)
max(NewPop4$i)
MaxPop <- colMax(NewPop4)
```

```{r}
CountryMax <- 
  cbind(CountryNames, MaxPop) %>%
  as.data.frame()
head(CountryMax)
```

```{r}
# no data for these points concerning carrying capacity, so using maximum documented population during time period of population data as carrying capacity
ModelPopTable4[4, 4] <- 58000
ModelPopTable4[61, 4] <- 51000
ModelPopTable4[71, 4] <- 30000
ModelPopTable4[73, 4] <- 58000
ModelPopTable4[75, 4] <- 162000
ModelPopTable4[82, 4] <- 7142000
ModelPopTable4[84, 4] <- 332000
ModelPopTable4[97, 4] <- 106000
ModelPopTable4[110, 4] <- 593000
ModelPopTable4[115, 4] <- 396000
ModelPopTable4[128, 4] <- 11000
ModelPopTable4[131, 4] <- 272000
ModelPopTable4[146, 4] <- 3822000
ModelPopTable4[151, 4] <- 52000
ModelPopTable4[153, 4] <- 7000
ModelPopTable4[154, 4] <- 109000
ModelPopTable4[156, 4] <- 195000
ModelPopTable4[160, 4] <- 93000
ModelPopTable4[176, 4] <- 23416000
ModelPopTable4[187, 4] <- 11000
ModelPopTable4[195, 4] <- 273000
ModelPopTable4[198, 4] <- 34000
ModelPopTable4[199, 4] <- 109000
ModelPopTable4[200, 4] <- 571000
```

###
```{r}
ModelPopTable4$InitialPop <- ModelPopTable4$InitialPop / 1000000
ModelPopTable4$Rate <- ModelPopTable4$Rate / 1000000
ModelPopTable4$CarryingCap <- ModelPopTable4$CarryingCap / 1000000
```

###

```{r}
FuturePop <- function(Year, x) {
  KeyValues <- ModelPopTable4[1, 2:4]
  
  KeyValues[3] / (1 + exp(KeyValues[1] - (KeyValues[2] * 20)))
}
```

```{r}
FuturePop(10, 1)
```

```{r}
UniqueValues <-
  as.numeric(ModelPopTable4[1, 2:4])

print(UniqueValues[2])
```

```{r}
322 / (1 + exp(1 - (.27 * 30)))
```

### Building a model for Emissions
 


### Simulating Future Emissions



## Data Visualizations


### Similar Countries; Unsupervised Learning -- Dendrogram

```{r}
Similarity2010 <-
  GlobalNumbers %>%
  select(`2010EmissionsPerCap`, `2010Pop`) %>%
  scale() %>%
  as.data.frame()

head(Similarity2010)
```

```{r fig.height=12, fig.width=18}
Distance2010 <-
  dist(Similarity2010)

Dendro2010 <-
  Distance2010 %>%
  hclust(method = "complete")

Dendro2010 %>%
  plot(labels = GlobalNumbers$Country)
```


### Heat map of Emissions

Maybe normalize each emission type and then add them together for a compound score?

```{r}
HeatMapData <-
  GlobalNumbers %>%
  select(-Country) %>%
  na.omit() %>%
  scale() %>%
  as.data.frame() %>%
  mutate(`1990` = `1990EmissionsPerCap` + (0.5 * `1990TotalEmissions`),
            `1995` = `1995EmissionsPerCap` + (0.5 * `1995TotalEmissions`),
            `2000` = `2000EmissionsPerCap` + (0.5 * `2000TotalEmissions`),
            `2005` = `2005EmissionsPerCap` + (0.5 * `2005TotalEmissions`),
            `2010` = `2010EmissionsPerCap` + (0.5 * `2010TotalEmissions`))

Top30Heat <-
  HeatMapData %>%
  cbind(GlobalNumbers$Country) %>%
  rename(Country = `GlobalNumbers$Country`) %>%
  top_n(n = 30, wt = `2010TotalEmissions`)

Top30HeatMatrix <-
  Top30Heat %>%
  select(`1990EmissionsPerCap`, `1995EmissionsPerCap`,`2000EmissionsPerCap`, `2005EmissionsPerCap`, `2010EmissionsPerCap`) %>%
  rename(Cap1990 = `1990EmissionsPerCap`,
         Cap1995 = `1995EmissionsPerCap`,
         Cap2000 = `2000EmissionsPerCap`,
         Cap2005 = `2005EmissionsPerCap`,
         Cap2010 = `2010EmissionsPerCap`) %>%
  as.matrix()
```

```{r}
EmissionsHeatmap <-
  heatmap(x = Top30HeatMatrix, Rowv = NA, Colv = NA, labRow = Top30Heat$Country)
```

### How Population Grows



### 

























































